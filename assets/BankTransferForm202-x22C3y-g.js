import{r as i,x as D,j as e,U as $,V as g,W as U,X as r,Y as A,Z as M,$ as T,a0 as L,a1 as B,a2 as E,a3 as P,a4 as c,a5 as b,C as q,D as y,E as N,A as F,N as O,O as V,P as z,Q as H,J}from"./index-m5tpGuMF.js";import{A as Q}from"./AppMenu202-CMiPFkHo.js";const W=l=>{navigator.clipboard.writeText(l).then(()=>{c.success("คัดลอกไปยังคลิปบอร์ด")}).catch(()=>{c.error("ไม่สามารถคัดลอกได้")})},X=({invoices:l,onSelect:h})=>e.jsx(b,{onClick:({key:s})=>h(s),children:l.map(s=>e.jsxs(b.Item,{children:[s.month,": ",s.total," บาท - ",s.status?"ชำระแล้ว":"รอชำระ"]},`${s.month}: ${s.total} บาท`))}),_=()=>{const[l,h]=i.useState([]),[s,w]=i.useState("เลือกใบแจ้งหนี้ที่จะชำระ"),[d,p]=i.useState(null),u=i.useRef(null),x=D();i.useEffect(()=>{(async()=>{try{const o=(await q(y(N,"invoices202"))).docs.map(n=>({id:n.id,...n.data()}));o.sort((n,m)=>{var f,j;return(((f=n.createdAt)==null?void 0:f.seconds)||0)-(((j=m.createdAt)==null?void 0:j.seconds)||0)}),h(o)}catch(t){console.error("เกิดข้อผิดพลาดในการดึงข้อมูลใบแจ้งหนี้: ",t),c.error("เกิดข้อผิดพลาดในการดึงข้อมูลใบแจ้งหนี้")}})()},[]);const R=a=>{w(a)},I=a=>{var o;const t=(o=a.target.files)==null?void 0:o[0];if(t){const n=URL.createObjectURL(t);p(n),c.success(`ไฟล์ "${t.name}" ได้รับการเลือกแล้ว`)}},v=()=>{p(null),c.info("ลบภาพออกแล้ว")},k=()=>{var a;(a=u.current)==null||a.click()},C=async()=>{if(!d||s==="เลือกใบแจ้งหนี้ที่จะชำระ"){c.error("กรุณาเลือกหลักฐานการชำระเงินและใบแจ้งหนี้ที่จะชำระ");return}try{if(!F.currentUser){c.error("คุณต้องเข้าสู่ระบบก่อน");return}const t=O(V,`proofs202/${Date.now()}_${Math.random()}`),n=await(await fetch(d)).blob();await z(t,n);const m=await H(t);await J(y(N,"paymentProofs202"),{invoice:s,imageUrl:m,status:"รอการอนุมัติ",timestamp:new Date}),c.success("ส่งหลักฐานการชำระเงินเรียบร้อยแล้ว"),x("/paymenthistory202",{state:{selectedText:s,selectedImage:m}})}catch(a){console.error("เกิดข้อผิดพลาดในการส่งหลักฐาน: ",a),c.error("เกิดข้อผิดพลาดในการส่งหลักฐานการชำระเงิน")}},S=()=>{x("/paymenthistory202")};return e.jsxs("div",{className:"bank-container",children:[e.jsxs("h3",{children:["แจ้งชำระค่าเช่า 202",e.jsx(Q,{})," "]}),e.jsxs($,{className:"space",direction:"vertical",size:"middle",children:[e.jsxs(g,{className:"card",title:"บัญชีสำหรับชำระหนี้",children:[e.jsxs("p",{className:"scb",children:[e.jsx("img",{src:"https://img5.pic.in.th/file/secure-sv1/unnamed4edf9fa04b6e50f3.png",alt:"Bank Logo",className:"logo-image"}),"  ธนาคารไทยพาณิชย์"]}),e.jsx("p",{className:"scb",children:"ชื่อบัญชี : ธนกร แดนประเทือง"}),e.jsxs("p",{className:"bum",children:["เลขบัญชี : 403-992701-1  ",e.jsx(U,{title:"คัดลอกหมายเลขบัญชี",children:e.jsx(r,{shape:"circle",icon:e.jsx(A,{}),onClick:()=>W("4039927011"),className:"copy-button"})})]}),e.jsx("p",{className:"scb1",children:"กำหนดชำระล่าช้าไม่เกินวันที่ 5 ของเดือนถัดไป"})]}),e.jsx(r,{icon:e.jsx(M,{}),onClick:S,className:"history-button","aria-label":"ดูประวัติการชำระเงิน",children:"ประวัติแจ้งชำระ"}),e.jsxs(g,{className:"card",title:"จำนวนเงินที่ต้องชำระ",children:[e.jsx(T,{overlay:e.jsx(X,{invoices:l,onSelect:R}),trigger:["click"],placement:"bottomRight",children:e.jsxs(r,{className:"dropdown-button",children:[s," ",e.jsx(L,{})]})}),e.jsx("pre",{}),e.jsx("input",{type:"file",id:"file-input",accept:"image/*",onChange:I,className:"file-input","aria-label":"เลือกไฟล์ภาพเพื่ออัปโหลด",ref:u,style:{display:"none"}}),e.jsx(r,{icon:e.jsx(B,{}),onClick:k,className:"upload-button","aria-label":"แนบรูปภาพ",children:"แนบรูปภาพ"}),e.jsx("pre",{}),d&&e.jsxs("div",{className:"image-preview",children:[e.jsx("img",{src:d,alt:"Selected",className:"image-preview-img"}),e.jsx(r,{icon:e.jsx(E,{}),onClick:v,className:"remove-image-button","aria-label":"ลบภาพที่แนบ",children:"ลบภาพ"})]}),e.jsx(r,{icon:e.jsx(P,{}),onClick:C,className:"submit-button","aria-label":"ส่งหลักฐานการชำระ",children:"กดส่งแจ้งหลักฐานการชำระ"})]})]})]})};export{_ as default};
