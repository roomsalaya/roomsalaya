import{r as o,j as e,M as k,B as E,C as L,D as g,E as i,A as O,F as f,G as w,J as A,K as M,N as P,O as B,P as G,Q as H}from"./index-J1teoIZ0.js";const K=()=>{const[F,C]=o.useState([]),[n,d]=o.useState({month:"",name:"",room:"",rent:"",electricity:"",water:"",total:"",status:!1}),[h,x]=o.useState(null),[v,u]=o.useState(!1),[j,p]=o.useState(null),c=async()=>{try{const t=await L(g(i,"invoices")),a=[];t.forEach(s=>{a.push({id:s.id,...s.data()})}),a.sort((s,r)=>{var m,b;return(((m=s.createdAt)==null?void 0:m.seconds)||0)-(((b=r.createdAt)==null?void 0:b.seconds)||0)}),C(a)}catch(t){console.error("เกิดข้อผิดพลาดในการดึงข้อมูลใบแจ้งหนี้: ",t)}};o.useEffect(()=>{c()},[]);const l=t=>{const{name:a,value:s}=t.target;d({...n,[a]:s,total:a==="rent"||a==="electricity"||a==="water"?R({...n,[a]:s}):n.total})},D=t=>{t.target.files&&t.target.files[0]&&p(t.target.files[0])},R=t=>{const a=parseFloat(t.rent)||0,s=parseFloat(t.electricity)||0,r=parseFloat(t.water)||0;return(a+s+r).toFixed(2)},N=async()=>{if(j){const t=P(B,`invoices/${j.name}`);return await G(t,j),await H(t)}return null},q=async t=>{t.preventDefault();try{const a=O.currentUser;if(!a){console.error("ไม่มีผู้ใช้งานที่ผ่านการยืนยัน");return}const s=await N(),r={...n,email:a.email,createdAt:new Date,fileURL:s};if(h){const m=f(i,"invoices",h);await w(m,r),await c(),x(null)}else await A(g(i,"invoices"),r),await c();d({month:"",name:"",room:"",rent:"",electricity:"",water:"",total:"",status:!1}),p(null),u(!1)}catch(a){console.error("เกิดข้อผิดพลาดในการเพิ่ม/แก้ไขเอกสาร: ",a)}},I=t=>{d(t),x(t.id||null),u(!0)},y=()=>{x(null),d({month:"",name:"",room:"",rent:"",electricity:"",water:"",total:"",status:!1}),p(null),u(!1)},S=async t=>{try{const a=f(i,"invoices",t.id);await w(a,{status:!t.status}),c()}catch(a){console.error("เกิดข้อผิดพลาดในการอัปเดตสถานะ: ",a)}},U=async t=>{try{await M(f(i,"invoices",t)),c()}catch(a){console.error("เกิดข้อผิดพลาดในการลบเอกสาร: ",a)}};return e.jsxs("div",{className:"house-info-container",children:[e.jsx("h2",{children:"รายการแจ้งหนี้ห้อง 201"}),e.jsx("button",{className:"add-invoice-button",onClick:()=>u(!0),children:"เพิ่มใบแจ้งหนี้"}),e.jsxs(k,{isOpen:v,onRequestClose:y,contentLabel:"Invoice Form",className:"invoice-modal",overlayClassName:"invoice-modal-overlay",children:[e.jsx("h2",{children:h?"แก้ไขใบแจ้งหนี้":"เพิ่มใบแจ้งหนี้"}),e.jsxs("form",{onSubmit:q,className:"invoice-form",children:[e.jsx("label",{htmlFor:"month",children:"เดือน:"}),e.jsx("input",{type:"text",id:"month",name:"month",value:n.month,onChange:l,placeholder:"เดือน",required:!0}),e.jsx("label",{htmlFor:"name",children:"ชื่อ:"}),e.jsx("input",{type:"text",id:"name",name:"name",value:n.name,onChange:l,placeholder:"ชื่อ",required:!0}),e.jsx("label",{htmlFor:"room",children:"ห้อง:"}),e.jsx("input",{type:"text",id:"room",name:"room",value:n.room,onChange:l,placeholder:"ห้อง",required:!0}),e.jsx("label",{htmlFor:"rent",children:"ค่าเช่า:"}),e.jsx("input",{type:"number",id:"rent",name:"rent",value:n.rent,onChange:l,placeholder:"ค่าเช่า",required:!0}),e.jsx("label",{htmlFor:"electricity",children:"ค่าไฟ:"}),e.jsx("input",{type:"number",id:"electricity",name:"electricity",value:n.electricity,onChange:l,placeholder:"ค่าไฟ",required:!0}),e.jsx("label",{htmlFor:"water",children:"ค่าน้ำ:"}),e.jsx("input",{type:"number",id:"water",name:"water",value:n.water,onChange:l,placeholder:"ค่าน้ำ",required:!0}),e.jsx("label",{htmlFor:"total",children:"รวม:"}),e.jsx("input",{type:"number",id:"total",name:"total",value:n.total,onChange:l,placeholder:"รวม",required:!0,readOnly:!0}),e.jsx("label",{htmlFor:"file",children:"ไฟล์:"}),e.jsx("input",{type:"file",id:"file",onChange:D}),e.jsx("button",{type:"submit",children:h?"บันทึกการเปลี่ยนแปลง":"เพิ่มใบแจ้งหนี้"}),e.jsx("button",{type:"button",onClick:y,children:"ยกเลิก"})]})]}),e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"เดือน"}),e.jsx("th",{children:"ชื่อ"}),e.jsx("th",{children:"ห้อง"}),e.jsx("th",{children:"ค่าเช่า"}),e.jsx("th",{children:"ค่าไฟ"}),e.jsx("th",{children:"ค่าน้ำ"}),e.jsx("th",{children:"รวม"}),e.jsx("th",{children:"สถานะ"}),e.jsx("th",{children:"ไฟล์ PDF"})," ",e.jsx("th",{children:"การกระทำ"})]})}),e.jsx("tbody",{children:F.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.month}),e.jsx("td",{children:t.name}),e.jsx("td",{children:t.room}),e.jsx("td",{children:t.rent}),e.jsx("td",{children:t.electricity}),e.jsx("td",{children:t.water}),e.jsx("td",{children:t.total}),e.jsx("td",{className:t.status?"paid-status":"unpaid-status",children:t.status?"อนุมัติชำระ":"รออนุมัติชำระ"}),e.jsx("td",{children:e.jsx("td",{children:t.fileURL?e.jsxs("a",{href:t.fileURL,target:"_blank",rel:"noopener noreferrer",className:"download-link",children:[e.jsx(E,{})," PDF"]}):"ไม่มีไฟล์"})}),e.jsxs("td",{children:[e.jsx("button",{className:"edit-button",onClick:()=>I(t),children:"แก้ไข"}),e.jsx("button",{className:"toggle-status-button",onClick:()=>S(t),children:t.status?"ยกเลิกอนุมัติ":"อนุมัติ"}),e.jsx("button",{className:"delete-button",onClick:()=>U(t.id),children:"ลบ"})]})]},t.id))})]})]})};export{K as default};
