import{r as i,j as e,M as U,B as k,C as L,D as g,E as d,A as O,F as y,G as w,J as A,K as M,N as B,O as P,P as G,Q as H}from"./index-Dt5Ubbtx.js";const K=()=>{const[C,F]=i.useState([]),[a,h]=i.useState({month:"",name:"",room:"",rent:"",electricity:"",water:"",fine:"",total:"",status:!1}),[u,j]=i.useState(null),[v,m]=i.useState(!1),[f,p]=i.useState(null),c=async()=>{try{const t=await L(g(d,"invoices202")),n=[];t.forEach(l=>{n.push({id:l.id,...l.data()})}),n.sort((l,s)=>{var o,x;return(((o=l.createdAt)==null?void 0:o.seconds)||0)-(((x=s.createdAt)==null?void 0:x.seconds)||0)}),F(n)}catch(t){console.error("Error fetching invoices: ",t)}};i.useEffect(()=>{c()},[]);const r=t=>{const{name:n,value:l}=t.target;h({...a,[n]:l,total:["rent","electricity","water","fine"].includes(n)?R({...a,[n]:l}):a.total})},D=t=>{t.target.files&&t.target.files[0]&&p(t.target.files[0])},R=t=>{const n=parseFloat(t.rent)||0,l=parseFloat(t.electricity)||0,s=parseFloat(t.water)||0,o=parseFloat(t.fine)||0,x=n+l+s+o;return Math.round(x).toString()},E=async()=>{if(f){const t=B(P,`invoices/${f.name}`);return await G(t,f),await H(t)}return null},N=async t=>{t.preventDefault();try{const n=O.currentUser;if(!n){console.error("No authenticated user");return}const l=await E(),s={...a,email:n.email,createdAt:new Date,fileURL:l};if(u){const o=y(d,"invoices202",u);await w(o,s),await c(),j(null)}else await A(g(d,"invoices202"),s),await c();h({month:"",name:"",room:"",rent:"",electricity:"",water:"",fine:"",total:"",status:!1}),p(null),m(!1)}catch(n){console.error("Error adding/updating document: ",n)}},S=t=>{h(t),j(t.id||null),m(!0)},b=()=>{j(null),h({month:"",name:"",room:"",rent:"",electricity:"",water:"",fine:"",total:"",status:!1}),p(null),m(!1)},q=async t=>{try{const n=y(d,"invoices202",t.id);await w(n,{status:!t.status}),c()}catch(n){console.error("Error updating status: ",n)}},I=async t=>{try{await M(y(d,"invoices202",t)),c()}catch(n){console.error("Error deleting document: ",n)}};return e.jsxs("div",{className:"house-info-container",children:[e.jsx("h2",{children:"รายการแจ้งหนี้ห้อง 202"}),e.jsx("button",{className:"add-invoice-button",onClick:()=>m(!0),children:"เพิ่มใบแจ้งหนี้"}),e.jsxs(U,{isOpen:v,onRequestClose:b,contentLabel:"Invoice Form",className:"invoice-modal",overlayClassName:"invoice-modal-overlay",children:[e.jsx("h2",{children:u?"แก้ไขใบแจ้งหนี้":"เพิ่มใบแจ้งหนี้"}),e.jsxs("form",{onSubmit:N,className:"invoice-form",children:[e.jsx("label",{htmlFor:"month",children:"เดือน:"}),e.jsx("input",{type:"text",id:"month",name:"month",value:a.month,onChange:r,placeholder:"เดือน",required:!0}),e.jsx("label",{htmlFor:"name",children:"ชื่อ:"}),e.jsx("input",{type:"text",id:"name",name:"name",value:a.name,onChange:r,placeholder:"ชื่อ",required:!0}),e.jsx("label",{htmlFor:"room",children:"ห้อง:"}),e.jsx("input",{type:"text",id:"room",name:"room",value:a.room,onChange:r,placeholder:"ห้อง",required:!0}),e.jsx("label",{htmlFor:"rent",children:"ค่าเช่า:"}),e.jsx("input",{type:"number",id:"rent",name:"rent",value:a.rent,onChange:r,placeholder:"ค่าเช่า",required:!0}),e.jsx("label",{htmlFor:"electricity",children:"ค่าไฟ:"}),e.jsx("input",{type:"number",id:"electricity",name:"electricity",value:a.electricity,onChange:r,placeholder:"ค่าไฟ",required:!0}),e.jsx("label",{htmlFor:"water",children:"ค่าน้ำ:"}),e.jsx("input",{type:"number",id:"water",name:"water",value:a.water,onChange:r,placeholder:"ค่าน้ำ",required:!0}),e.jsx("label",{htmlFor:"fine",children:"ค่าปรับ:"}),e.jsx("input",{type:"number",id:"fine",name:"fine",value:a.fine,onChange:r,placeholder:"ค่าปรับ"}),e.jsx("label",{htmlFor:"total",children:"รวม:"}),e.jsx("input",{type:"number",id:"total",name:"total",value:a.total,onChange:r,placeholder:"รวม",required:!0,readOnly:!0}),e.jsx("label",{htmlFor:"file",children:"ไฟล์:"}),e.jsx("input",{type:"file",id:"file",onChange:D}),e.jsx("button",{type:"submit",children:u?"บันทึกการแก้ไข":"เพิ่มใบแจ้งหนี้"}),e.jsx("button",{type:"button",onClick:b,children:"ยกเลิก"})]})]}),e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"เดือน"}),e.jsx("th",{children:"ชื่อ"}),e.jsx("th",{children:"ห้อง"}),e.jsx("th",{children:"ค่าเช่า"}),e.jsx("th",{children:"ค่าไฟ"}),e.jsx("th",{children:"ค่าน้ำ"}),e.jsx("th",{children:"ค่าปรับ"}),e.jsx("th",{children:"รวม"}),e.jsx("th",{children:"สถานะ"}),e.jsx("th",{children:"ไฟล์"}),e.jsx("th",{children:"ดำเนินการ"})]})}),e.jsx("tbody",{children:C.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:t.month}),e.jsx("td",{children:t.name}),e.jsx("td",{children:t.room}),e.jsx("td",{children:t.rent}),e.jsx("td",{children:t.electricity}),e.jsx("td",{children:t.water}),e.jsx("td",{children:t.fine}),e.jsx("td",{children:t.total}),e.jsx("td",{children:t.status?"จ่ายแล้ว":"ยังไม่จ่าย"}),e.jsx("td",{children:t.fileURL?e.jsxs("a",{href:t.fileURL,target:"_blank",rel:"noopener noreferrer",className:"download-link",children:[e.jsx(k,{})," PDF"]}):"-"}),e.jsxs("td",{children:[e.jsx("button",{className:"edit-button",onClick:()=>S(t),children:"แก้ไข"}),e.jsx("button",{className:"toggle-status-button",onClick:()=>q(t),children:t.status?"ยังไม่จ่าย":"จ่ายแล้ว"}),e.jsx("button",{className:"delete-button",onClick:()=>I(t.id),children:"ลบ"})]})]},t.id))})]})]})};export{K as default};
